/*! For license information please see main~bef837c7.bundle.js.LICENSE.txt */
(()=>{"use strict";var t,e={358:(t,e,r)=>{function a(t){return a="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(t){return typeof t}:function(t){return t&&"function"==typeof Symbol&&t.constructor===Symbol&&t!==Symbol.prototype?"symbol":typeof t},a(t)}function i(t){return function(t){if(Array.isArray(t))return n(t)}(t)||function(t){if("undefined"!=typeof Symbol&&null!=t[Symbol.iterator]||null!=t["@@iterator"])return Array.from(t)}(t)||function(t,e){if(t){if("string"==typeof t)return n(t,e);var r={}.toString.call(t).slice(8,-1);return"Object"===r&&t.constructor&&(r=t.constructor.name),"Map"===r||"Set"===r?Array.from(t):"Arguments"===r||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(r)?n(t,e):void 0}}(t)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function n(t,e){(null==e||e>t.length)&&(e=t.length);for(var r=0,a=Array(e);r<e;r++)a[r]=t[r];return a}function o(){o=function(){return e};var t,e={},r=Object.prototype,i=r.hasOwnProperty,n="function"==typeof Symbol?Symbol:{},s=n.iterator||"@@iterator",c=n.asyncIterator||"@@asyncIterator",l=n.toStringTag||"@@toStringTag";function u(t,e,r,a){return Object.defineProperty(t,e,{value:r,enumerable:!a,configurable:!a,writable:!a})}try{u({},"")}catch(t){u=function(t,e,r){return t[e]=r}}function d(e,r,a,i){var n=r&&r.prototype instanceof m?r:m,o=Object.create(n.prototype);return u(o,"_invoke",function(e,r,a){var i=1;return function(n,o){if(3===i)throw Error("Generator is already running");if(4===i){if("throw"===n)throw o;return{value:t,done:!0}}for(a.method=n,a.arg=o;;){var s=a.delegate;if(s){var c=L(s,a);if(c){if(c===p)continue;return c}}if("next"===a.method)a.sent=a._sent=a.arg;else if("throw"===a.method){if(1===i)throw i=4,a.arg;a.dispatchException(a.arg)}else"return"===a.method&&a.abrupt("return",a.arg);i=3;var l=h(e,r,a);if("normal"===l.type){if(i=a.done?4:2,l.arg===p)continue;return{value:l.arg,done:a.done}}"throw"===l.type&&(i=4,a.method="throw",a.arg=l.arg)}}}(e,a,new x(i||[])),!0),o}function h(t,e,r){try{return{type:"normal",arg:t.call(e,r)}}catch(t){return{type:"throw",arg:t}}}e.wrap=d;var p={};function m(){}function f(){}function v(){}var y={};u(y,s,(function(){return this}));var g=Object.getPrototypeOf,b=g&&g(g(I([])));b&&b!==r&&i.call(b,s)&&(y=b);var k=v.prototype=m.prototype=Object.create(y);function w(t){["next","throw","return"].forEach((function(e){u(t,e,(function(t){return this._invoke(e,t)}))}))}function S(t,e){function r(n,o,s,c){var l=h(t[n],t,o);if("throw"!==l.type){var u=l.arg,d=u.value;return d&&"object"==a(d)&&i.call(d,"__await")?e.resolve(d.__await).then((function(t){r("next",t,s,c)}),(function(t){r("throw",t,s,c)})):e.resolve(d).then((function(t){u.value=t,s(u)}),(function(t){return r("throw",t,s,c)}))}c(l.arg)}var n;u(this,"_invoke",(function(t,a){function i(){return new e((function(e,i){r(t,a,e,i)}))}return n=n?n.then(i,i):i()}),!0)}function L(e,r){var a=r.method,i=e.i[a];if(i===t)return r.delegate=null,"throw"===a&&e.i.return&&(r.method="return",r.arg=t,L(e,r),"throw"===r.method)||"return"!==a&&(r.method="throw",r.arg=new TypeError("The iterator does not provide a '"+a+"' method")),p;var n=h(i,e.i,r.arg);if("throw"===n.type)return r.method="throw",r.arg=n.arg,r.delegate=null,p;var o=n.arg;return o?o.done?(r[e.r]=o.value,r.next=e.n,"return"!==r.method&&(r.method="next",r.arg=t),r.delegate=null,p):o:(r.method="throw",r.arg=new TypeError("iterator result is not an object"),r.delegate=null,p)}function E(t){this.tryEntries.push(t)}function C(e){var r=e[4]||{};r.type="normal",r.arg=t,e[4]=r}function x(t){this.tryEntries=[[-1]],t.forEach(E,this),this.reset(!0)}function I(e){if(null!=e){var r=e[s];if(r)return r.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var n=-1,o=function r(){for(;++n<e.length;)if(i.call(e,n))return r.value=e[n],r.done=!1,r;return r.value=t,r.done=!0,r};return o.next=o}}throw new TypeError(a(e)+" is not iterable")}return f.prototype=v,u(k,"constructor",v),u(v,"constructor",f),f.displayName=u(v,l,"GeneratorFunction"),e.isGeneratorFunction=function(t){var e="function"==typeof t&&t.constructor;return!!e&&(e===f||"GeneratorFunction"===(e.displayName||e.name))},e.mark=function(t){return Object.setPrototypeOf?Object.setPrototypeOf(t,v):(t.__proto__=v,u(t,l,"GeneratorFunction")),t.prototype=Object.create(k),t},e.awrap=function(t){return{__await:t}},w(S.prototype),u(S.prototype,c,(function(){return this})),e.AsyncIterator=S,e.async=function(t,r,a,i,n){void 0===n&&(n=Promise);var o=new S(d(t,r,a,i),n);return e.isGeneratorFunction(r)?o:o.next().then((function(t){return t.done?t.value:o.next()}))},w(k),u(k,l,"Generator"),u(k,s,(function(){return this})),u(k,"toString",(function(){return"[object Generator]"})),e.keys=function(t){var e=Object(t),r=[];for(var a in e)r.unshift(a);return function t(){for(;r.length;)if((a=r.pop())in e)return t.value=a,t.done=!1,t;return t.done=!0,t}},e.values=I,x.prototype={constructor:x,reset:function(e){if(this.prev=this.next=0,this.sent=this._sent=t,this.done=!1,this.delegate=null,this.method="next",this.arg=t,this.tryEntries.forEach(C),!e)for(var r in this)"t"===r.charAt(0)&&i.call(this,r)&&!isNaN(+r.slice(1))&&(this[r]=t)},stop:function(){this.done=!0;var t=this.tryEntries[0][4];if("throw"===t.type)throw t.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var r=this;function a(t){o.type="throw",o.arg=e,r.next=t}for(var i=r.tryEntries.length-1;i>=0;--i){var n=this.tryEntries[i],o=n[4],s=this.prev,c=n[1],l=n[2];if(-1===n[0])return a("end"),!1;if(!c&&!l)throw Error("try statement without catch or finally");if(null!=n[0]&&n[0]<=s){if(s<c)return this.method="next",this.arg=t,a(c),!0;if(s<l)return a(l),!1}}},abrupt:function(t,e){for(var r=this.tryEntries.length-1;r>=0;--r){var a=this.tryEntries[r];if(a[0]>-1&&a[0]<=this.prev&&this.prev<a[2]){var i=a;break}}i&&("break"===t||"continue"===t)&&i[0]<=e&&e<=i[2]&&(i=null);var n=i?i[4]:{};return n.type=t,n.arg=e,i?(this.method="next",this.next=i[2],p):this.complete(n)},complete:function(t,e){if("throw"===t.type)throw t.arg;return"break"===t.type||"continue"===t.type?this.next=t.arg:"return"===t.type?(this.rval=this.arg=t.arg,this.method="return",this.next="end"):"normal"===t.type&&e&&(this.next=e),p},finish:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[2]===t)return this.complete(r[4],r[3]),C(r),p}},catch:function(t){for(var e=this.tryEntries.length-1;e>=0;--e){var r=this.tryEntries[e];if(r[0]===t){var a=r[4];if("throw"===a.type){var i=a.arg;C(r)}return i}}throw Error("illegal catch attempt")},delegateYield:function(e,r,a){return this.delegate={i:I(e),r,n:a},"next"===this.method&&(this.arg=t),p}},e}function s(t,e,r,a,i,n,o){try{var s=t[n](o),c=s.value}catch(t){return void r(t)}s.done?e(c):Promise.resolve(c).then(a,i)}function c(t){return function(){var e=this,r=arguments;return new Promise((function(a,i){var n=t.apply(e,r);function o(t){s(n,a,i,o,c,"next",t)}function c(t){s(n,a,i,o,c,"throw",t)}o(void 0)}))}}function l(t,e){for(var r=0;r<e.length;r++){var a=e[r];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(t,u(a.key),a)}}function u(t){var e=function(t){if("object"!=a(t)||!t)return t;var e=t[Symbol.toPrimitive];if(void 0!==e){var r=e.call(t,"string");if("object"!=a(r))return r;throw new TypeError("@@toPrimitive must return a primitive value.")}return String(t)}(t);return"symbol"==a(e)?e:e+""}r.d(e,{A:()=>d});const d=function(){return t=function t(){!function(t,e){if(!(t instanceof e))throw new TypeError("Cannot call a class as a function")}(this,t),this.storyList=document.getElementById("story-list"),this.storyForm=document.getElementById("story-form"),this.loginForm=document.getElementById("login-form"),this.registerForm=document.getElementById("register-form"),this.camera=document.getElementById("camera"),this.canvas=document.getElementById("canvas"),this.captureBtn=document.getElementById("capture"),this.mapContainer=document.getElementById("map"),this.storyMapContainer=document.getElementById("story-map"),this.pages=document.querySelectorAll(".page"),this.photoInput=document.getElementById("photo"),this.photoPreview=document.getElementById("preview"),this.navList=document.getElementById("nav-list"),this.navLinks=document.querySelectorAll("nav a"),this.storySearch=document.getElementById("story-search"),this.searchButton=document.getElementById("search-button"),this.filterTabs=document.querySelectorAll(".filter-tab"),this.authContainer=document.getElementById("auth-container"),this.appHeader=document.getElementById("app-header"),this.loginSection=document.getElementById("login"),this.registerSection=document.getElementById("register"),this.openCameraBtn=document.getElementById("open-camera"),this.closeCameraBtn=document.getElementById("close-camera"),this.cameraContainer=document.getElementById("camera-container"),this.detailContent=document.getElementById("detail-content"),this.editStoryBtn=document.getElementById("edit-story"),this.deleteStoryBtn=document.getElementById("delete-story"),this.editStoryForm=document.getElementById("edit-story-form"),this.editPreview=document.getElementById("edit-preview"),this.editPhotoInput=document.getElementById("edit-photo"),this.editDescription=document.getElementById("edit-description"),this.editStoryId=document.getElementById("edit-story-id"),this.backToDetailBtn=document.getElementById("back-to-detail"),this.map=null,this.storyMap=null,this.currentMarker=null,this.storyMarkers=[],this.stream=null,this.capturedImageData=null,this.isCameraActive=!1,this.currentStoryId=null,this.allStories=[],this.favoriteStories=[],this.currentFilter="all",this.searchQuery="",this.searchDebounceTimer=null,this.onRegisterSubmit=null,this.onLoginSubmit=null,this.onStorySubmit=null,this.onCaptureClick=null,this.onNavLinkClick=null,this.onMapClick=null,this.onFavoriteClick=null,this.onFilterChange=null,this.onStoryClick=null,this.onEditStorySubmit=null,this.onDeleteStory=null,this._initializeEventListeners(),this._setupImageErrorHandling(),this._setupAuthLinks(),this._setupStoryFilters(),this._setupStoryDetailActions()},e=[{key:"_initializeEventListeners",value:function(){this._setupSkipToContent(),this._setupPhotoInput(),this._setupFormEventListeners(),this._setupNavigationEventListeners(),this._setupPasswordToggle(),this._setupFormValidation(),this._setupEditPhotoInput()}},{key:"_setupSkipToContent",value:function(){var t=document.querySelector("#main-content"),e=document.querySelector(".skip-to-content");e&&t&&e.addEventListener("click",(function(r){r.preventDefault(),e.blur(),t.focus(),t.scrollIntoView()}))}},{key:"_setupPhotoInput",value:function(){var t=this;this.photoInput.addEventListener("change",(function(e){var r=e.target.files[0];if(r&&r.type.startsWith("image/")){if(r.size>1048576)return t.showMessage("Ukuran foto terlalu besar. Maksimal 1MB.",!0),void(t.photoInput.value="");t._previewImageFile(r)}else t.showMessage("Harap pilih file gambar yang valid.",!0),t.photoInput.value=""}))}},{key:"_previewImageFile",value:function(t){var e=this,r=new FileReader;r.onload=function(t){e.photoPreview.src=t.target.result,e.photoPreview.classList.remove("hidden"),e.capturedImageData=null},r.readAsDataURL(t)}},{key:"_setupFormEventListeners",value:function(){var t=this;this.registerForm.addEventListener("submit",(function(e){e.preventDefault();var r=e.target.querySelector("#register-name"),a=e.target.querySelector("#register-email"),i=e.target.querySelector("#register-password");if(!r.validity.valid||!a.validity.valid||!i.validity.valid)return t._validateInput(r),t._validateInput(a),t._validateInput(i),void t.showMessage("Harap perbaiki form sebelum mendaftar.",!0);if(t.onRegisterSubmit){var n=new FormData(e.target),o={name:n.get("name"),email:n.get("email"),password:n.get("password")},s=e.target.querySelector('button[type="submit"]');t._setButtonLoading(s,!0),t.onRegisterSubmit(o).catch((function(t){return console.error("Register error:",t)})).finally((function(){t._setButtonLoading(s,!1)}))}})),this.loginForm.addEventListener("submit",(function(e){e.preventDefault();var r=e.target.querySelector("#login-email"),a=e.target.querySelector("#login-password");if(!r.validity.valid||!a.validity.valid)return t._validateInput(r),t._validateInput(a),void t.showMessage("Harap perbaiki form sebelum login.",!0);if(t.onLoginSubmit){var i=new FormData(e.target),n={email:i.get("email"),password:i.get("password")},o=e.target.querySelector('button[type="submit"]');t._setButtonLoading(o,!0),t.onLoginSubmit(n).catch((function(t){return console.error("Login error:",t)})).finally((function(){t._setButtonLoading(o,!1)}))}})),this.storyForm.addEventListener("submit",(function(e){if(e.preventDefault(),t.onStorySubmit){var r={description:e.target.description.value.trim(),photoFile:t.getPhotoFromInput(),imageData:t.capturedImageData},a=e.target.querySelector('button[type="submit"]');t._setButtonLoading(a,!0),t.onStorySubmit(r).finally((function(){t._setButtonLoading(a,!1)}))}})),this.captureBtn.addEventListener("click",(function(){t.onCaptureClick&&t.onCaptureClick()})),this.openCameraBtn&&this.openCameraBtn.addEventListener("click",c(o().mark((function e(){return o().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.openCamera();case 2:case"end":return e.stop()}}),e)})))),this.closeCameraBtn&&this.closeCameraBtn.addEventListener("click",(function(){t.closeCamera()}))}},{key:"_setupNavigationEventListeners",value:function(){var t=this;this.navLinks.forEach((function(e){e.addEventListener("click",(function(r){if(t.onNavLinkClick){var a=e.getAttribute("href").substring(1);t.onNavLinkClick(r,a)}}))}))}},{key:"_setupPasswordToggle",value:function(){document.querySelectorAll(".toggle-password").forEach((function(t){t.addEventListener("click",(function(){var e=t.getAttribute("data-target"),r=document.getElementById(e),a=t.querySelector("i");"password"===r.type?(r.type="text",a.classList.remove("fa-eye"),a.classList.add("fa-eye-slash"),t.setAttribute("aria-label","Sembunyikan password")):(r.type="password",a.classList.remove("fa-eye-slash"),a.classList.add("fa-eye"),t.setAttribute("aria-label","Tampilkan password"))}))}))}},{key:"_setupAuthLinks",value:function(){var t=this;document.querySelectorAll(".auth-switch a").forEach((function(e){e.addEventListener("click",(function(r){r.preventDefault();var a=e.getAttribute("href").substring(1);t.showAuthSection(a),window.location.hash=a}))}))}},{key:"showAuthSection",value:function(t){this.loginSection.classList.add("hidden"),this.registerSection.classList.add("hidden"),"login"===t?this.loginSection.classList.remove("hidden"):"register"===t&&this.registerSection.classList.remove("hidden")}},{key:"updateNav",value:function(t){t?(this.appHeader.classList.remove("hidden"),this.authContainer.classList.add("hidden"),this.showPage("home")):(this.appHeader.classList.add("hidden"),this.authContainer.classList.remove("hidden"),"register"===(window.location.hash.slice(1)||"login")?this.showAuthSection("register"):this.showAuthSection("login"),this.pages.forEach((function(t){t.classList.add("hidden")})))}},{key:"displayStories",value:function(t){var e=this,r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];this.searchQuery||"all"!==this.currentFilter||(this.allStories=i(t)),r.length&&(this.favoriteStories=i(r)),this.storyList.innerHTML="",this.clearStoryMapMarkers(),t.forEach((function(t){var a=document.createElement("div");a.className="story-card",a.setAttribute("role","listitem"),a.setAttribute("data-story-id",t.id);var i=r.some((function(e){return e.id===t.id})),n="Lokasi tidak tersedia";if(t.lat&&t.lon){var o=parseFloat(t.lat).toFixed(4),s=parseFloat(t.lon).toFixed(4);n="".concat(o,", ").concat(s)}a.innerHTML='\n        <div class="img-container">\n          <img src="'.concat(t.photoUrl,'" alt="Foto cerita ').concat(t.name,'" loading="lazy">\n        </div>\n        <h3>').concat(t.name,"</h3>\n        <p>").concat(t.description,'</p>\n        <div class="location-display">\n          <i class="fas fa-map-marker-alt"></i> ').concat(n,"\n        </div>\n        <p>Dibuat: ").concat(new Date(t.createdAt).toLocaleDateString("id-ID"),'</p>\n        <button class="favorite-btn ').concat(i?"favorited":"",'"\n                 data-story-id="').concat(t.id,'"\n                 data-processing="false"\n                 data-favorited="').concat(i,'"\n                 aria-label="').concat(i?"Hapus dari favorit":"Tambah ke favorit",'">\n          <i class="fas fa-heart"></i>\n          <span class="favorite-text">').concat(i?"Hapus dari Favorit":"Tambah ke Favorit",'</span>\n        </button>\n        <button class="view-detail-btn" data-story-id="').concat(t.id,'">\n          <i class="fas fa-eye"></i> Lihat Detail\n        </button>\n      '),e.storyList.appendChild(a);var c=a.querySelector(".favorite-btn");c.addEventListener("click",(function(r){if(r.stopPropagation(),"true"!==c.getAttribute("data-processing")&&e.onFavoriteClick){var a="true"===c.getAttribute("data-favorited");c.setAttribute("data-processing","true"),e._setButtonLoading(c,!0),e.onFavoriteClick(t,!a).finally((function(){c.setAttribute("data-processing","false"),e._setButtonLoading(c,!1)}))}})),a.querySelector(".view-detail-btn").addEventListener("click",(function(r){r.stopPropagation(),e.onStoryClick&&e.onStoryClick(t.id)})),a.addEventListener("click",(function(){e.onStoryClick&&e.onStoryClick(t.id)})),t.lat&&t.lon&&e.addStoryMarker(t);var l=a.querySelector("img");l.complete&&0===l.naturalHeight&&e._handleImageError(l)}))}},{key:"updateFavoriteButton",value:function(t,e){var r=document.querySelector('.favorite-btn[data-story-id="'.concat(t,'"]'));if(r){if(r.setAttribute("data-favorited",e),e){r.classList.add("favorited");var a=r.querySelector(".favorite-text");if(a?a.textContent="Hapus dari Favorit":r.innerHTML='<i class="fas fa-heart"></i> <span class="favorite-text">Hapus dari Favorit</span>',r.setAttribute("aria-label","Hapus dari favorit"),!this.favoriteStories.some((function(e){return e.id===t}))){var i=this.allStories.find((function(e){return e.id===t}));i&&this.favoriteStories.push(i)}}else{r.classList.remove("favorited");var n=r.querySelector(".favorite-text");n?n.textContent="Tambah ke Favorit":r.innerHTML='<i class="fas fa-heart"></i> <span class="favorite-text">Tambah ke Favorit</span>',r.setAttribute("aria-label","Tambah ke favorit"),this.favoriteStories=this.favoriteStories.filter((function(e){return e.id!==t})),"favorites"===this.currentFilter&&this._applyFiltersAndSearch()}r.setAttribute("data-processing","false")}}},{key:"displayFavoriteStories",value:function(t){this.favoriteStories=i(t),this.filterTabs.forEach((function(t){t.classList.toggle("active","favorites"===t.getAttribute("data-filter"))})),this.currentFilter="favorites",this._displayFilteredStories(t)}},{key:"setActiveFilter",value:function(t){["all","newest","oldest","favorites"].includes(t)||(t="all"),this.currentFilter=t,this.filterTabs.forEach((function(e){e.classList.toggle("active",e.getAttribute("data-filter")===t)})),this._applyFiltersAndSearch()}},{key:"clearSearch",value:function(){this.storySearch&&(this.storySearch.value="",this.searchQuery="",this._applyFiltersAndSearch())}},{key:"_applyFiltersAndSearch",value:function(){var t=this;if(this.allStories.length){var e=i(this.allStories);switch(this.searchQuery&&(e=e.filter((function(e){return e.name.toLowerCase().includes(t.searchQuery)||e.description.toLowerCase().includes(t.searchQuery)}))),this.currentFilter){case"newest":default:e.sort((function(t,e){return new Date(e.createdAt)-new Date(t.createdAt)}));break;case"oldest":e.sort((function(t,e){return new Date(t.createdAt)-new Date(e.createdAt)}));break;case"favorites":e=this.favoriteStories}this._displayFilteredStories(e)}}},{key:"_displayFilteredStories",value:function(t){var e=this;if(this.storyList.innerHTML="",this.clearStoryMapMarkers(),0===t.length){var r="Tidak ada cerita yang ditemukan";return this.searchQuery?r='Tidak ada cerita yang cocok dengan "'.concat(this.searchQuery,'"'):"favorites"===this.currentFilter&&(r="Belum ada cerita favorit"),void(this.storyList.innerHTML='\n        <div class="empty-state">\n        <i class="fas fa-search fa-3x"></i>\n        <h3>'.concat(r,"</h3>\n        <p>Coba dengan pencarian lain atau pilih filter yang berbeda.</p>\n        </div>\n      "))}t.forEach((function(t){var r=document.createElement("div");r.className="story-card",r.setAttribute("role","listitem");var a=e.favoriteStories.some((function(e){return e.id===t.id})),i="Lokasi tidak tersedia";if(t.lat&&t.lon){var n=parseFloat(t.lat).toFixed(4),o=parseFloat(t.lon).toFixed(4);i="".concat(n,", ").concat(o)}r.innerHTML='\n        <div class="img-container">\n          <img src="'.concat(t.photoUrl,'" alt="Foto cerita ').concat(t.name,'" loading="lazy">\n        </div>\n        <h3>').concat(t.name,"</h3>\n        <p>").concat(t.description,'</p>\n        <div class="location-display">\n          <i class="fas fa-map-marker-alt"></i> ').concat(i,"\n        </div>\n        <p>Dibuat: ").concat(new Date(t.createdAt).toLocaleDateString("id-ID"),'</p>\n        <button class="favorite-btn ').concat(a?"favorited":"",'"\n                 data-story-id="').concat(t.id,'"\n                 data-processing="false"\n                 data-favorited="').concat(a,'"\n                 aria-label="').concat(a?"Hapus dari favorit":"Tambah ke favorit",'">\n          <i class="fas fa-heart"></i>\n          <span class="favorite-text">').concat(a?"Hapus dari Favorit":"Tambah ke Favorit","</span>\n        </button>\n      "),e.storyList.appendChild(r);var s=r.querySelector(".favorite-btn");s.addEventListener("click",(function(){if("true"!==s.getAttribute("data-processing")&&e.onFavoriteClick){var r="true"===s.getAttribute("data-favorited");s.setAttribute("data-processing","true"),e._setButtonLoading(s,!0),e.onFavoriteClick(t,!r).finally((function(){s.setAttribute("data-processing","false"),e._setButtonLoading(s,!1)}))}})),t.lat&&t.lon&&e.addStoryMarker(t);var c=r.querySelector("img");c.complete&&0===c.naturalHeight&&e._handleImageError(c)}))}},{key:"openCamera",value:(n=c(o().mark((function t(){var e,r,a;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!this.isCameraActive){t.next=2;break}return t.abrupt("return");case 2:return t.prev=2,this.cameraContainer&&this.cameraContainer.classList.remove("hidden"),(e=document.createElement("div")).className="camera-loading",e.innerHTML='<div class="loading-spinner"></div><p>Memulai kamera...</p>',this.cameraContainer.appendChild(e),t.next=10,navigator.mediaDevices.getUserMedia({video:{width:{ideal:1280,max:1920},height:{ideal:720,max:1080},facingMode:"environment"}});case 10:return r=t.sent,e.parentNode&&e.parentNode.removeChild(e),this.camera.srcObject=r,this.stream=r,this.isCameraActive=!0,t.next=17,this.camera.play();case 17:this.openCameraBtn&&this.openCameraBtn.classList.add("hidden"),t.next=26;break;case 20:t.prev=20,t.t0=t.catch(2),(a=this.cameraContainer.querySelector(".camera-loading"))&&a.parentNode.removeChild(a),this.showMessage("Tidak dapat mengakses kamera: "+t.t0.message,!0),this.closeCamera();case 26:case"end":return t.stop()}}),t,this,[[2,20]])}))),function(){return n.apply(this,arguments)})},{key:"closeCamera",value:function(){this.stopCamera(),this.isCameraActive=!1,this.cameraContainer&&this.cameraContainer.classList.add("hidden"),this.openCameraBtn&&this.openCameraBtn.classList.remove("hidden")}},{key:"stopCamera",value:function(){this.stream&&(this.stream.getTracks().forEach((function(t){return t.stop()})),this.stream=null,this.camera.srcObject=null)}},{key:"setupCamera",value:(a=c(o().mark((function t(){return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.abrupt("return",!0);case 1:case"end":return t.stop()}}),t)}))),function(){return a.apply(this,arguments)})},{key:"captureImage",value:function(){if(!this.stream||!this.isCameraActive)return null;try{var t=this.canvas.getContext("2d"),e=this.camera.videoWidth,r=this.camera.videoHeight;return this.canvas.width=e,this.canvas.height=r,t.drawImage(this.camera,0,0,e,r),this.capturedImageData=this.canvas.toDataURL("image/jpeg",.85),this.capturedImageData}catch(t){return console.error("Error capturing image:",t),null}}},{key:"showImagePreview",value:function(t){this.photoPreview.src=t,this.photoPreview.classList.remove("hidden"),this.photoInput.value=""}},{key:"setupMap",value:function(){var t=this;if(this.map)return this.map;this.mapContainer.setAttribute("aria-label","Peta interaktif untuk memilih lokasi cerita"),this.map=L.map(this.mapContainer).setView([-6.1783,106.6319],13);var e=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:"© OpenStreetMap contributors"}),r=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}.png",{attribution:"© CartoDB"}),a=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20}),i=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"© Esri"}),n=L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{attribution:"© OpenTopoMap contributors"});e.addTo(this.map);var o={OpenStreetMap:e,"Dark Theme":a,"Light Theme":r,Satellite:i,Topographic:n};return L.control.layers(o).addTo(this.map),this.map.on("click",(function(e){t.onMapClick&&t.onMapClick(e.latlng)})),this.map}},{key:"setupStoryMap",value:function(){if(this.storyMap)return this.storyMap;this.storyMap=L.map(this.storyMapContainer,{center:[-2.5,118],zoom:5,scrollWheelZoom:!0,zoomControl:!0,maxBounds:[[-13,93],[8,142]],minZoom:5});var t=L.tileLayer("https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors',maxZoom:19}),e=L.tileLayer("https://{s}.basemaps.cartocdn.com/dark_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20}),r=L.tileLayer("https://server.arcgisonline.com/ArcGIS/rest/services/World_Imagery/MapServer/tile/{z}/{y}/{x}",{attribution:"© Esri",maxZoom:19}),a=L.tileLayer("https://{s}.tile.opentopomap.org/{z}/{x}/{y}.png",{attribution:"© OpenTopoMap contributors",maxZoom:19}),i=L.tileLayer("https://{s}.basemaps.cartocdn.com/light_all/{z}/{x}/{y}{r}.png",{attribution:'&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors &copy; <a href="https://carto.com/attributions">CARTO</a>',subdomains:"abcd",maxZoom:20});t.addTo(this.storyMap);var n={OpenStreetMap:t,"Dark Theme":e,"Light Theme":i,Satellite:r,Topographic:a};return L.control.layers(n).addTo(this.storyMap),L.control.fullscreen&&L.control.fullscreen({position:"topleft",title:"Tampilkan peta penuh",titleCancel:"Keluar dari mode penuh",forceSeparateButton:!0}).addTo(this.storyMap),L.control.locate&&L.control.locate({position:"topleft",strings:{title:"Tunjukkan lokasi saya"},locateOptions:{enableHighAccuracy:!0}}).addTo(this.storyMap),this.markerClusterGroup=L.markerClusterGroup(),this.storyMap.addLayer(this.markerClusterGroup),this.storyMap}},{key:"updateMapMarker",value:function(t){this.map&&(this.currentMarker&&this.map.removeLayer(this.currentMarker),this.currentMarker=L.marker([t.lat,t.lng]).addTo(this.map),this.currentMarker.bindPopup("Lokasi Cerita").openPopup())}},{key:"clearMapMarkers",value:function(){this.map&&this.currentMarker&&(this.map.removeLayer(this.currentMarker),this.currentMarker=null)}},{key:"clearStoryMapMarkers",value:function(){var t=this;this.storyMap&&this.storyMarkers.length>0&&(this.storyMarkers.forEach((function(e){return t.storyMap.removeLayer(e)})),this.storyMarkers=[])}},{key:"showPage",value:function(t){this.pages.forEach((function(e){e.classList.toggle("hidden",e.id!==t)}))}},{key:"showMessage",value:function(t){var e=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(console.log("Showing message: ".concat(t,", isError: ").concat(e)),"undefined"==typeof Swal)return console.error("SweetAlert2 is not loaded. Falling back to alert."),void alert(t);try{Swal.fire({title:e?"Gagal!":"Sukses!",text:t,icon:e?"error":"success",confirmButtonColor:"#3B82F6",timer:e?void 0:2e3,showConfirmButton:e,background:"#2d3536",color:"#ffffff",iconColor:e?"#dc3545":"#4BB543",position:"top",toast:!e,timerProgressBar:!e,customClass:{container:"swal2-container-custom",popup:"swal2-popup-custom"},padding:"1em",didOpen:function(t){e||(t.style.marginTop="70px")}})}catch(e){console.error("Error showing SweetAlert2 message:",e),alert(t)}}},{key:"resetStoryForm",value:function(){this.storyForm.reset(),this.photoPreview.classList.add("hidden"),this.photoPreview.src="",this.photoInput.value="",this.capturedImageData=null,this.closeCamera()}},{key:"getPhotoFromInput",value:function(){return this.photoInput.files.length>0?this.photoInput.files[0]:null}},{key:"navigateTo",value:function(t){window.location.hash=t}},{key:"getCurrentHash",value:function(){return window.location.hash.slice(1)||"login"}},{key:"handlePageViewTransition",value:function(t,e){var r=this;this._updateActiveNavLink(t),document.startViewTransition?document.startViewTransition(c(o().mark((function a(){var i,n;return o().wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(i=document.querySelector(".page:not(.hidden)"),n=document.getElementById(t),!i){a.next=6;break}return i.style.animation="fadeOut 0.3s ease-out forwards",a.next=6,new Promise((function(t){return setTimeout(t,300)}));case 6:if(r.showPage(t),n&&(n.style.animation="fadeIn 0.5s ease-in forwards"),!e){a.next=11;break}return a.next=11,e();case 11:case"end":return a.stop()}}),a)})))):(this.showPage(t),e&&e())}},{key:"_updateActiveNavLink",value:function(t){this.navLinks.forEach((function(t){t.classList.remove("active")}));var e=document.querySelector('nav a[href="#'.concat(t,'"]'));e&&e.classList.add("active")}},{key:"setupNotificationButton",value:function(t){var e=document.querySelector("#notification-button");e||((e=document.createElement("button")).id="notification-button",e.textContent="Aktifkan Notifikasi",e.className="btn-secondary",e.style.cssText="\n        position: fixed;\n        bottom: 20px;\n        right: 20px;\n        z-index: 1000;\n        padding: 10px 15px;\n        background: #3B82F6;\n        color: white;\n        border: none;\n        border-radius: 5px;\n        cursor: pointer;\n      ",document.body.appendChild(e)),e.addEventListener("click",t)}},{key:"updateNotificationUI",value:function(t){var e=document.querySelector("#notification-button");e&&(t?(e.textContent="Notifikasi Aktif",e.style.background="#10B981",e.disabled=!0):(e.textContent="Aktifkan Notifikasi",e.style.background="#3B82F6",e.disabled=!1))}},{key:"_setupImageErrorHandling",value:function(){var t=this;document.addEventListener("error",(function(e){"img"===e.target.tagName.toLowerCase()&&t._handleImageError(e.target)}),!0)}},{key:"_handleImageError",value:function(t){if("preview"!==t.id&&(t.classList.add("error"),t.closest(".story-card"))){var e=t.parentElement;if(e.classList.contains("img-container")||((e=document.createElement("div")).className="img-container",t.parentNode.insertBefore(e,t),e.appendChild(t)),!e.querySelector(".img-error")){var r=document.createElement("div");r.className="img-error",r.innerHTML='<i class="fas fa-image"></i><br>Gambar tidak tersedia',e.appendChild(r)}}}},{key:"_setButtonLoading",value:function(t,e){t&&(e?(t.disabled=!0,t.classList.add("loading"),t.dataset.originalText||(t.dataset.originalText=t.innerHTML),t.innerHTML="",t.setAttribute("aria-busy","true")):(t.disabled=!1,t.classList.remove("loading"),t.dataset.originalText&&(t.innerHTML=t.dataset.originalText,delete t.dataset.originalText),t.removeAttribute("aria-busy")))}},{key:"addStoryMarker",value:function(t){if(this.storyMap&&t.lat&&t.lon){var e=L.divIcon({html:'<div class="custom-marker"><i class="fas fa-map-marker-alt"></i></div>',className:"story-marker-icon",iconSize:[30,42],iconAnchor:[15,42],popupAnchor:[0,-42]}),r=L.marker([t.lat,t.lon],{icon:e}).addTo(this.storyMap);r.bindPopup('\n      <div class="marker-popup">\n        <h4>'.concat(t.name,"</h4>\n        <p>").concat(t.description.substring(0,100)).concat(t.description.length>100?"...":"",'</p>\n        <div class="popup-image">\n          <img src="').concat(t.photoUrl,'" alt="Foto cerita ').concat(t.name,'" style="max-width: 100%; max-height: 120px; object-fit: cover; border-radius: 4px;">\n        </div>\n        <p class="popup-date">Dibuat: ').concat(new Date(t.createdAt).toLocaleDateString("id-ID"),"</p>\n      </div>\n    "),{maxWidth:300,className:"story-popup"}),this.storyMarkers.push(r)}}},{key:"reverseGeocode",value:(r=c(o().mark((function t(e,r){var a,i;return o().wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,fetch("https://nominatim.openstreetmap.org/reverse?format=json&lat=".concat(e,"&lon=").concat(r));case 3:return a=t.sent,t.next=6,a.json();case 6:return i=t.sent,t.abrupt("return",i.display_name||"Unknown location");case 10:return t.prev=10,t.t0=t.catch(0),console.error("Error in reverse geocoding:",t.t0),t.abrupt("return","Unknown location");case 14:case"end":return t.stop()}}),t,null,[[0,10]])}))),function(t,e){return r.apply(this,arguments)})},{key:"_setupStoryFilters",value:function(){var t=this;this.storySearch&&this.searchButton&&(this.storySearch.addEventListener("input",(function(e){clearTimeout(t.searchDebounceTimer),t.searchDebounceTimer=setTimeout((function(){t.searchQuery=e.target.value.trim().toLowerCase(),t._applyFiltersAndSearch()}),300)})),this.searchButton.addEventListener("click",(function(){t.searchQuery=t.storySearch.value.trim().toLowerCase(),t._applyFiltersAndSearch()})),this.storySearch.addEventListener("keypress",(function(e){"Enter"===e.key&&(e.preventDefault(),t.searchQuery=t.storySearch.value.trim().toLowerCase(),t._applyFiltersAndSearch())}))),this.filterTabs&&this.filterTabs.forEach((function(e){e.addEventListener("click",(function(){t.filterTabs.forEach((function(t){return t.classList.remove("active")})),e.classList.add("active"),t.currentFilter=e.getAttribute("data-filter"),t._applyFiltersAndSearch(),t.onFilterChange&&t.onFilterChange(t.currentFilter)}))}))}},{key:"_setupFormValidation",value:function(){var t=this;if(this.loginForm){var e=this.loginForm.querySelector("#login-email"),r=this.loginForm.querySelector("#login-password");this._addValidationMessage(e,"Masukkan email yang valid"),this._addValidationMessage(r,"Password minimal 6 karakter"),e.addEventListener("input",(function(){t._validateInput(e)})),r.addEventListener("input",(function(){t._validateInput(r)}))}if(this.registerForm){var a=this.registerForm.querySelector("#register-name"),i=this.registerForm.querySelector("#register-email"),n=this.registerForm.querySelector("#register-password");this._addValidationMessage(a,"Nama minimal 3 karakter"),this._addValidationMessage(i,"Masukkan email yang valid"),this._addValidationMessage(n,"Password minimal 6 karakter"),a.addEventListener("input",(function(){t._validateInput(a)})),i.addEventListener("input",(function(){t._validateInput(i)})),n.addEventListener("input",(function(){t._validateInput(n)}))}}},{key:"_addValidationMessage",value:function(t,e){var r=t.nextElementSibling;if(!r||!r.classList.contains("validation-message"))if((r=document.createElement("div")).className="validation-message",r.innerText=e,"login-password"===t.id||"register-password"===t.id){var a=t.closest(".password-input");a.parentNode.insertBefore(r,a.nextSibling)}else t.parentNode.insertBefore(r,t.nextSibling)}},{key:"_validateInput",value:function(t){t.classList.remove("error","success"),t.validity.valid?t.classList.add("success"):t.classList.add("error")}},{key:"_setupEditPhotoInput",value:function(){var t=this;this.editPhotoInput&&this.editPhotoInput.addEventListener("change",(function(e){var r=e.target.files[0];if(r&&r.type.startsWith("image/")){if(r.size>1048576)return t.showMessage("Ukuran foto terlalu besar. Maksimal 1MB.",!0),void(t.editPhotoInput.value="");var a=new FileReader;a.onload=function(e){t.editPreview.src=e.target.result,t.editPreview.classList.remove("hidden")},a.readAsDataURL(r)}else t.showMessage("Harap pilih file gambar yang valid.",!0),t.editPhotoInput.value=""}))}},{key:"_setupStoryDetailActions",value:function(){var t=this;this.editStoryBtn&&this.editStoryBtn.addEventListener("click",(function(){t.currentStoryId&&t.navigateTo("edit-story-page")})),this.deleteStoryBtn&&this.deleteStoryBtn.addEventListener("click",(function(){t.currentStoryId&&t.onDeleteStory&&t._showDeleteConfirmation(t.currentStoryId)})),this.editStoryForm&&this.editStoryForm.addEventListener("submit",(function(e){if(e.preventDefault(),t.onEditStorySubmit){var r=t.editStoryId.value,a=t.editDescription.value,i=t.editPhotoInput.files[0],n=e.target.querySelector('button[type="submit"]');t._setButtonLoading(n,!0),t.onEditStorySubmit(r,a,i).catch((function(t){return console.error("Edit story error:",t)})).finally((function(){t._setButtonLoading(n,!1)}))}}))}},{key:"_showDeleteConfirmation",value:function(t){var e=this;Swal.fire({title:"Hapus Cerita?",text:"Cerita yang sudah dihapus tidak dapat dikembalikan",icon:"warning",showCancelButton:!0,confirmButtonColor:"#d33",cancelButtonColor:"#3085d6",confirmButtonText:"Ya, hapus cerita",cancelButtonText:"Batal",customClass:{container:"swal2-container-custom",popup:"swal2-popup-custom"}}).then((function(r){r.isConfirmed&&e.onDeleteStory&&(e._setButtonLoading(e.deleteStoryBtn,!0),e.onDeleteStory(t).catch((function(t){return console.error("Delete story error:",t)})).finally((function(){e._setButtonLoading(e.deleteStoryBtn,!1)})))}))}},{key:"displayStoryDetail",value:function(t){if(t&&this.detailContent){this.currentStoryId=t.id;var e="Lokasi tidak tersedia";if(t.lat&&t.lon){var r=parseFloat(t.lat).toFixed(4),a=parseFloat(t.lon).toFixed(4);e="".concat(r,", ").concat(a)}this.detailContent.innerHTML='\n      <img src="'.concat(t.photoUrl,'" alt="Foto cerita ').concat(t.name,'">\n      <h2>').concat(t.name,'</h2>\n      <div class="meta">\n        <span><i class="fas fa-calendar"></i> ').concat(new Date(t.createdAt).toLocaleDateString("id-ID"),"</span>\n        ").concat(t.lastUpdated?'<span><i class="fas fa-edit"></i> Diedit: '.concat(new Date(t.lastUpdated).toLocaleDateString("id-ID"),"</span>"):"","\n      </div>\n      <p>").concat(t.description,'</p>\n      <div class="location">\n        <i class="fas fa-map-marker-alt"></i> ').concat(e,"\n      </div>\n    "),this.editStoryId&&(this.editStoryId.value=t.id),this.editDescription&&(this.editDescription.value=t.description),this.editPreview&&(this.editPreview.src=t.photoUrl,this.editPreview.classList.remove("hidden")),this.navigateTo("story-detail")}}}],e&&l(t.prototype,e),Object.defineProperty(t,"prototype",{writable:!1}),t;var t,e,r,a,n}()}},r={};function a(t){var i=r[t];if(void 0!==i)return i.exports;var n=r[t]={id:t,exports:{}};return e[t](n,n.exports,a),n.exports}a.m=e,t=[],a.O=(e,r,i,n)=>{if(!r){var o=1/0;for(u=0;u<t.length;u++){for(var[r,i,n]=t[u],s=!0,c=0;c<r.length;c++)(!1&n||o>=n)&&Object.keys(a.O).every((t=>a.O[t](r[c])))?r.splice(c--,1):(s=!1,n<o&&(o=n));if(s){t.splice(u--,1);var l=i();void 0!==l&&(e=l)}}return e}n=n||0;for(var u=t.length;u>0&&t[u-1][2]>n;u--)t[u]=t[u-1];t[u]=[r,i,n]},a.n=t=>{var e=t&&t.__esModule?()=>t.default:()=>t;return a.d(e,{a:e}),e},a.d=(t,e)=>{for(var r in e)a.o(e,r)&&!a.o(t,r)&&Object.defineProperty(t,r,{enumerable:!0,get:e[r]})},a.o=(t,e)=>Object.prototype.hasOwnProperty.call(t,e),(()=>{var t={79:0};a.O.j=e=>0===t[e];var e=(e,r)=>{var i,n,[o,s,c]=r,l=0;if(o.some((e=>0!==t[e]))){for(i in s)a.o(s,i)&&(a.m[i]=s[i]);if(c)var u=c(a)}for(e&&e(r);l<o.length;l++)n=o[l],a.o(t,n)&&t[n]&&t[n][0](),t[n]=0;return a.O(u)},r=self.webpackChunkstory_sharing_app=self.webpackChunkstory_sharing_app||[];r.forEach(e.bind(null,0)),r.push=e.bind(null,r.push.bind(r))})(),a.nc=void 0;var i=a.O(void 0,[528,377,313],(()=>a(429)));i=a.O(i)})();