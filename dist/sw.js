const CACHE_NAME="story-app-v3";self.addEventListener("install",(e=>{console.log("Service Worker installing."),self.skipWaiting()})),self.addEventListener("activate",(e=>{console.log("Service Worker activating."),e.waitUntil(caches.keys().then((e=>Promise.all(e.map((e=>{if(e!==CACHE_NAME)return console.log("Service Worker: Clearing old cache:",e),caches.delete(e)})))))),e.waitUntil(clients.claim())})),self.addEventListener("fetch",(e=>{"GET"===e.request.method&&("navigate"!==e.request.mode?e.respondWith(caches.match(e.request).then((t=>t||("image"===e.request.destination||"font"===e.request.destination?fetch(e.request).then((t=>{if(t.ok){const i=t.clone();caches.open(CACHE_NAME).then((t=>{t.put(e.request,i)}))}return t})):fetch(e.request))))):e.respondWith(fetch(e.request).catch((()=>caches.match("/offline.html")))))})),self.addEventListener("push",(e=>{let t={};try{t=e.data.json()}catch(i){t={title:"Notifikasi Baru",body:e.data?e.data.text():"Ada pembaruan baru!"}}const i={body:t.body||"Ada pembaruan baru!",icon:"/favicon.ico",vibrate:[100,50,100],data:{url:t.url||"/"}};e.waitUntil(self.registration.showNotification(t.title||"Notifikasi Baru",i))})),self.addEventListener("notificationclick",(e=>{e.notification.close(),e.waitUntil(clients.matchAll({type:"window"}).then((t=>{const i=e.notification.data.url||"/";for(const e of t)if(e.url===i&&"focus"in e)return e.focus();if(clients.openWindow)return clients.openWindow(i)})))}));